# 치킨마스터2 — 게임 메카닉 설명서

## 목차
1. [자원 시스템](#1-자원-시스템)
2. [시간 시스템 (4구간 하루)](#2-시간-시스템)
3. [플레이어 스탯](#3-플레이어-스탯)
4. [피로 시스템](#4-피로-시스템)
5. [행동 목록](#5-행동-목록)
6. [영업 시스템](#6-영업-시스템)
7. [의사결정 이벤트](#7-의사결정-이벤트)
8. [수면 & 일일 정산](#8-수면--일일-정산)
9. [주사위 시스템](#9-주사위-시스템)
10. [변수 상호작용 맵](#10-변수-상호작용-맵)

---

## 1. 자원 시스템

### 자금 (Money)

| 항목 | 값 |
|------|-----|
| 초기 자금 | ₩2,000,000 |
| 월세 | ₩1,500,000 |
| 초기 판매가 | ₩20,000 |
| 가격 범위 | ₩5,000 ~ ₩100,000 (₩1,000 단위) |

**수입원**: 영업 매출 (`판매 수 × 유효가격`), 의사결정 보너스 (특별주문 +₩30,000)
**지출처**: 재료 주문 (₩200,000), 전단지 (₩50,000), 온라인광고 (₩100,000), 배달앱 (₩30,000), 알바 고용 (₩80,000), 의사결정 비용 (긴급주문 ₩100,000)

---

### 재료 (Ingredient Qty)

| 항목 | 값 |
|------|-----|
| 초기량 | 100개 |
| 범위 | 0 ~ 무제한 |

**소비**: 재료 준비 시 **-3개** (PREPARE_INGREDIENTS)
**획득**: 재료 주문 시 **+50개** (ORDER_INGREDIENTS), 의사결정 +30개 (긴급주문)

> 재료는 직접 팔 수 없음. 반드시 "준비" 과정을 거쳐야 판매 가능.

---

### 준비량 (Prepared Qty)

| 항목 | 값 |
|------|-----|
| 초기량 | 0개 |
| 범위 | 0 ~ 무제한 |
| 매일 수면 시 | **0으로 리셋** |

**획득**: `PREPARE_INGREDIENTS` → 기본 **+5개**, 주사위 보정으로 **+5~15개** (상세: [주사위 시스템](#9-주사위-시스템))
**소비**: 영업 중 고객 1명당 1개 사용 → `판매 수 = min(방문고객, 준비량)`

> **핵심 흐름**: 재료(-3) → 준비(+5) → 영업에서 소비 → 수면 시 0으로 리셋

---

### 신선도 (Ingredient Freshness)

| 항목 | 값 |
|------|-----|
| 초기값 | 90 |
| 범위 | 0 ~ 100 |
| 일일 감쇄 | `3 + (재료량 ÷ 50) × 2` |

**감쇄 예시**:
- 재료 50개: 3 + 1×2 = **-5/일**
- 재료 100개: 3 + 2×2 = **-7/일**
- 재료 200개: 3 + 4×2 = **-11/일** ← 대량 비축 페널티

**영업 영향**: 고객 수 배율 = `신선도 ÷ 80` (최소 0.5, 최대 1.2)
| 신선도 | 배율 | 효과 |
|--------|------|------|
| 100 | ×1.2 | 고객 20% 증가 |
| 80 | ×1.0 | 기본 |
| 40 | ×0.5 | 고객 50% 감소 |
| 40 미만 | ×0.5 + 평판-2 | 최악 |

**재료 주문 시**: 가중 평균 적용 — `(기존량×기존신선도 + 50×100) ÷ 총량`

---

### 평판 (Reputation)

| 항목 | 값 |
|------|-----|
| 초기값 | 50 |
| 범위 | 0 ~ 100 |

**증가**: 컴플레인 정중 대응 (+5)
**감소**: 돌아간 고객 (`-돌아간수÷5`, 최대 -10), 컴플레인 무시 (-5), 신선도 40미만 (-2/일)

**영업 영향**: 고객 수 배율 = `평판 ÷ 50`
| 평판 | 배율 | 효과 |
|------|------|------|
| 100 | ×2.0 | 고객 2배 |
| 50 | ×1.0 | 기본 |
| 25 | ×0.5 | 고객 반감 |
| 0 | ×0.0 | 고객 없음 |

---

## 2. 시간 시스템

### 하루 4구간

```
┌──────────┬───────────┬──────────────┬──────────┬──────────┐
│  PREP    │ BUSINESS  │    NIGHT     │  SLEEP   │ 다음날   │
│  준비    │  영업     │    야간      │  수면    │  PREP    │
│ 07~10시  │ 10~21시   │  21~24시     │ 24~07시  │          │
│  3시간   │  11시간   │   3시간      │  7시간   │          │
└──────────┴───────────┴──────────────┴──────────┴──────────┘
   수동       자동         수동          자동
  행동큐    타임랩스      행동큐       자동회복
```

### 시간 설정 범위

| 설정 | 기본값 | 범위 | 영향 |
|------|--------|------|------|
| 기상 시간 | 07시 | 05~08 | PREP 시간 = 개점-기상 |
| 개점 시간 | 10시 | 09~12 | BUSINESS 시간 = 폐점-개점 |
| 폐점 시간 | 21시 | 18~23 | NIGHT 시간 = 취침-폐점 |
| 취침 시간 | 24시 | 22~26 | SLEEP 시간 = (기상+24)-취침 |

> 시간 배분은 전략의 핵심. 영업 시간↑ = 매출↑ but 준비/야간 시간↓

---

## 3. 플레이어 스탯

### 5대 스탯

| 스탯 | 초기값 | 용도 |
|------|--------|------|
| **요리 (Cooking)** | 10 | 연구 진행도, 준비 품질 |
| **경영 (Management)** | 8 | 연구 진행도, 광고 효과 |
| **서비스 (Service)** | 8 | 연구 진행도, 고객 만족 |
| **기술 (Tech)** | 5 | 연구 진행도, 장비/기술 |
| **체력 (Stamina)** | 50 | 피로 임계치 결정 |

### 경험치 획득

각 행동은 시간당 경험치를 부여합니다: `총 경험치 = 시간당 경험치 × 행동시간`

| 행동 | 요리 | 경영 | 서비스 | 기술 | 체력 |
|------|------|------|--------|------|------|
| 재료 준비 | +4/h | — | — | — | — |
| 재료 검수 | +4/h | +2/h | — | — | — |
| 청소 | — | — | +10/h | — | — |
| 장비 점검 | — | +4/h | — | +8/h | — |
| 레시피 연구 | +15/h | — | — | — | — |
| 경영 연구 | — | +15/h | — | — | — |
| 광고 연구 | — | +12/h | — | +8/h | — |
| 서비스 연구 | — | — | +15/h | — | — |
| 학습 | — | +5/h | — | +15/h | — |
| 운동 | — | — | — | — | +20/h |
| 전단지 | — | +6/h | — | — | — |
| 온라인 광고 | — | +8/h | — | +4/h | — |
| 배달앱 등록 | — | +6/h | — | +6/h | — |
| 재료 주문 | — | +8/h | — | — | — |
| 알바 고용 | — | +10/h | — | — | — |
| 휴식 | — | — | — | — | +8/h |

---

## 4. 피로 시스템

| 단계 | 조건 | 효과 |
|------|------|------|
| 정상 | 피로 < 체력×0.5 | 없음 |
| 피로 | 피로 ≥ 체력×0.5 (25) | 경고 표시 |
| 과로 | 피로 ≥ 체력×0.9 (45) | 심각 경고 |
| 기절 | 피로 ≥ 체력×1.0 (50) | **모든 스탯 50% 감소** |
| 탈진 | 피로 ≥ 체력×2.0 (100) | 행동 불가 (수면만 가능) |

> 체력 스탯을 올리면 피로 임계치가 높아져 더 오래 활동 가능

**피로 회복**:
- 휴식 (REST/SLEEP 카드): **-16/시간** (0.5h = -8)
- 수면 구간: **-16 × 수면시간** (기본 7h = -112)

---

## 5. 행동 목록

### PREP 구간 (준비 시간)

| 행동 | 시간 | 비용 | 피로 | 효과 |
|------|------|------|------|------|
| 재료 준비 | 1h | 0원 | +3 | 재료-3, **준비량+5** (주사위 보정) |
| 재료 검수 | 1h | 0원 | +2 | (검수 효과) |
| 청소 | 2h | 0원 | +5/h | (매장 정리) |
| 장비 점검 | 1h | 0원 | +3 | (장비 상태) |
| 휴식 | 0.5h | 0원 | **-8** | 피로 회복 |

### NIGHT 구간 (야간 시간)

| 행동 | 시간 | 비용 | 피로 | 효과 |
|------|------|------|------|------|
| 레시피 연구 | 3h | 0원 | +3/h | 요리 경험치 |
| 경영 연구 | 3h | 0원 | +2/h | 경영 경험치 |
| 광고 연구 | 3h | 0원 | +2/h | 경영+기술 경험치 |
| 서비스 연구 | 3h | 0원 | +3/h | 서비스 경험치 |
| 학습 | 2h | 0원 | +2/h | 기술+경영 경험치 |
| 운동 | 2h | 0원 | +4/h | **체력 경험치** |
| 전단지 | 2h | ₩50,000 | +2/h | 경영 경험치 |
| 온라인 광고 | 1h | ₩100,000 | +1/h | 경영+기술 경험치 |
| 배달앱 등록 | 1h | ₩30,000 | +1/h | 경영+기술 경험치 |
| 재료 주문 | 1h | ₩200,000 | +2 | **재료+50**, 신선도 갱신 |
| 알바 고용 | 2h | ₩80,000 | +2/h | 경영+서비스 경험치 |
| 휴식 | 0.5h | 0원 | **-8** | 피로 회복 |

### BUSINESS 구간 (영업 중 긴급 행동)

준비량 5개 미만일 때 자동 제안:

| 행동 | 시간 | 효과 |
|------|------|------|
| 재료 준비 | 1h (영업시간 -1h) | 재료-3, 준비량+5 |
| 휴식 | 1h (영업시간 -1h) | 피로-16 |
| 그냥 계속 영업 | 0h | 변화 없음 |

---

## 6. 영업 시스템

### 고객 수 공식

```
시간당 기본 고객 = 3명
평판 배율 = 평판 ÷ 50
신선도 배율 = clamp(신선도 ÷ 80, 0.5, 1.2)

기본 고객 수 = 영업시간 × 3 × 평판배율 × 신선도배율
```

**예시 (기본 설정)**:
- 평판 50, 신선도 90: `11 × 3 × 1.0 × 1.125 = 37명`
- 평판 80, 신선도 100: `11 × 3 × 1.6 × 1.2 = 63명`
- 평판 30, 신선도 50: `11 × 3 × 0.6 × 0.625 = 12명`

### 매출 공식

```
판매 수 = min(총 방문 고객, 준비량)
돌아간 고객 = 총 방문 고객 - 판매 수

유효가격 = 판매가 × max(0.5, 1.0 - 마진페널티%) × max(0.3, 1.0 - 판매페널티%)
총 매출 = 판매 수 × 유효가격
```

### 시간별 타임랩스

- 매 2초 = 1시간 경과
- 시간별 고객은 `기본고객/h × 랜덤(0.7~1.3)` 변동
- **준비량은 실시간 추적** — 이벤트/행동 후 즉시 반영
- 준비량 < 5개 시 긴급 행동 선택지 자동 제시

---

## 7. 의사결정 이벤트

영업 중 1~2개 랜덤 발생. 각각 A/B 선택.

### 이벤트 목록

#### 점심 러시 (lunch_rush)
> "점심시간 손님이 몰립니다! 할인할까요?"

| 선택 | 효과 |
|------|------|
| A: 할인 실시 | 고객 +30%, 마진 -20% |
| B: 거절 | 변화 없음 |

#### 단체 예약 (group_reservation)
> "근처 회사에서 단체 주문이 들어왔습니다."

| 선택 | 효과 |
|------|------|
| A: 수락 | 고객 +15명, **준비량 -15** |
| B: 거절 | 변화 없음 |

#### 재료 부족 (ingredient_shortage)
> "재료가 부족합니다! 긴급 주문할까요?"

| 선택 | 효과 |
|------|------|
| A: 긴급 주문 | 자금 -₩100,000, 재료 +30 |
| B: 그냥 버틴다 | 판매량 -30% |

#### 서비스 컴플레인 (complaint)
> "고객이 서비스에 불만을 표시합니다."

| 선택 | 효과 |
|------|------|
| A: 정중 대응 | **평판 +5** |
| B: 무시 | **평판 -5** |

#### 특별 주문 (special_order)
> "특별 주문이 들어왔습니다."

| 선택 | 효과 |
|------|------|
| A: 수락 | 자금 +₩30,000, 피로 +5 |
| B: 거절 | 변화 없음 |

#### 배달 폭주 (delivery_rush)
> "배달 주문이 폭주합니다!"

| 선택 | 효과 |
|------|------|
| A: 전부 수락 | 고객 +10명, 피로 +8 |
| B: 일부만 | 고객 +3명 |

---

## 8. 수면 & 일일 정산

SLEEP 구간에서 자동 실행:

```
1. 피로 회복: 피로 -= 수면시간 × 16 (기본 7h = -112)
2. 신선도 감쇄: 신선도 -= 3 + (재료량 ÷ 50) × 2
3. 평판 페널티: 신선도 < 40이면 평판 -2
4. 준비량 리셋: prepared_qty → 0 (다음날 새로 준비해야 함)
5. 다음 턴 생성 → PREP 구간으로 복귀
```

---

## 9. 주사위 시스템

PREP/NIGHT 행동 확정 시, 각 행동마다 **d100 주사위** 1회 굴림 + **관련 스탯** 연동.

### 공식

```
dice_factor = max(0.5, (관련 스탯 + d100) ÷ 100)
```

스탯 최대치가 100이므로, d100과 합산하면 직관적인 **퍼센트** 계산:
- 스탯 + 주사위 합이 100 → ×1.0 (기본)
- 스탯 + 주사위 합이 200 → ×2.0 (최대)
- 스탯 + 주사위 합이 50 → ×0.5 (최소)

### 행동별 관련 스탯

| 행동 | 관련 스탯 |
|------|-----------|
| 재료 준비 / 재료 검수 | 요리 (cooking) |
| 청소 / 서비스 연구 | 서비스 (service) |
| 장비 점검 / 학습 / 온라인광고 / 배달앱 | 기술 (tech) |
| 경영 연구 / 전단지 / 재료 주문 / 알바 고용 | 경영 (management) |
| 운동 | 체력 (stamina) |
| 레시피 연구 | 요리 (cooking) |

### 예시: 재료 준비 (요리 스탯 10, 초기값)

| d100 | 스탯+d100 | dice_factor | 준비량 (base 5) |
|------|-----------|-------------|-----------------|
| 95+ (CRITICAL!) | 105+ | ×1.05+ | **+5개** |
| 75 (GREAT) | 85 | ×0.85 | **+4개** |
| 50 (평균) | 60 | ×0.60 | **+3개** |
| 10 (MISS) | 20 | ×0.50 | **+2개** |

### 예시: 재료 준비 (요리 스탯 80, 성장 후)

| d100 | 스탯+d100 | dice_factor | 준비량 (base 5) |
|------|-----------|-------------|-----------------|
| 95+ (CRITICAL!) | 175+ | ×1.75 | **+8개** |
| 75 (GREAT) | 155 | ×1.55 | **+7개** |
| 50 (평균) | 130 | ×1.30 | **+6개** |
| 5 (MISS) | 85 | ×0.85 | **+4개** |

> 스탯이 높을수록 최소 보장치가 올라감. 주사위는 플레이어에게 보이지 않음.

---

## 10. 변수 상호작용 맵

### 핵심 연결 관계

```
┌─────────────────────────────────────────────────────────┐
│                    💰 자금 (Money)                       │
│  ← 영업 매출, 의사결정 보너스                            │
│  → 재료 주문, 광고, 고용 비용                            │
└──────────────────────┬──────────────────────────────────┘
                       │
┌──────────────────────▼──────────────────────────────────┐
│               🥩 재료 (Ingredient)                       │
│  ← 재료 주문 (+50), 의사결정 (+30)                       │
│  → 재료 준비 (-3 per action)                             │
│  ⟷ 신선도 (보유량↑ → 감쇄↑)                             │
└──────────────────────┬──────────────────────────────────┘
                       │ 준비 행동
┌──────────────────────▼──────────────────────────────────┐
│              🍗 준비량 (Prepared)                         │
│  ← 재료 준비 (+5×dice), 영업중 긴급 준비                 │
│  → 영업 판매 (1고객=1준비량), 수면 시 0 리셋             │
│  ※ 준비량 = 하루 최대 판매 가능량                        │
└──────────────────────┬──────────────────────────────────┘
                       │ 영업
┌──────────────────────▼──────────────────────────────────┐
│              👥 고객 수 (Customers)                       │
│  = 영업시간 × 3 × (평판÷50) × (신선도÷80)               │
│  + 의사결정 보너스                                       │
│  판매 수 = min(고객, 준비량)                              │
│  돌아간 고객 → 평판 감소                                 │
└──────────────────────┬──────────────────────────────────┘
                       │
        ┌──────────────┼──────────────┐
        ▼              ▼              ▼
   ⭐ 평판          🌿 신선도       😴 피로
   ← 컴플레인       ← 수면 감쇄     ← 행동 수행
   ← 돌아간 고객    ← 재료 주문     ← 의사결정
   → 고객 수 배율   → 고객 수 배율  → 스탯 효율
   → 평판<40 페널티  → 평판 페널티   → 행동 제한
```

### 선순환과 악순환

**선순환 루프** ✅:
```
많은 준비 → 판매↑ → 매출↑ → 재료 주문 가능 → 신선도 유지 → 고객↑ → 매출↑
         → 돌아간 고객↓ → 평판 유지 → 고객↑
```

**악순환 루프** ❌:
```
준비 부족 → 돌아간 고객↑ → 평판↓ → 고객↓ → 매출↓ → 재료 구매 어려움
                                                    → 신선도↓ → 평판↓↓
```

### 변수별 영향 요약표

| 변수 | 변경되는 곳 | 영향 주는 곳 |
|------|------------|------------|
| **자금** | 영업매출, 의사결정, 행동비용 | 행동 가용성 (비용 체크) |
| **재료** | 주문(+50), 준비(-3), 의사결정(+30) | 준비량 생산, 신선도 감쇄율 |
| **준비량** | 준비행동(+5×dice), 영업(-판매수), 수면(→0) | **영업 매출 상한** |
| **신선도** | 수면(-감쇄), 주문(가중평균) | 고객수 배율, 평판 페널티 |
| **평판** | 컴플레인(±5), 돌아간고객(-), 신선도페널티(-2) | 고객수 배율 |
| **피로** | 행동(+), 휴식(-8), 수면(-112), 의사결정(+) | 스탯 효율, 행동 제한 |
| **요리** | 준비/검수/레시피 경험치 | 연구 진행도 |
| **경영** | 연구/광고/주문 경험치 | 연구 진행도 |
| **서비스** | 청소/서비스연구/알바 경험치 | 연구 진행도 |
| **기술** | 장비/학습/광고 경험치 | 연구 진행도 |
| **체력** | 운동/휴식 경험치 | 피로 임계치 (체력↑=더 오래 활동) |

---

## 부록: 수치 상수 총람 (balance.py)

```
초기자금          = 2,000,000원
초기재료          = 100개
초기판매가        = 20,000원
초기신선도        = 90
초기평판          = 50
월세              = 1,500,000원

시간당 고객       = 3명
평판 기준값       = 50
마진하한          = 0.5 (50%)
판매하한          = 0.3 (30%)

준비 획득량       = +5개/회
준비 재료소비     = -3개/회
재료 주문량       = +50개/회
주문 신선도       = 100

신선도 기본감쇄   = -3/일
비축 페널티 단위  = 50개당 -2 추가
신선도 판매기준   = 80 (이 값으로 나눔)
신선도 최소배율   = 0.5
신선도 최대배율   = 1.2
신선도 평판임계   = 40 미만 시 평판-2

돌아감 평판단위   = 5명당 -1
돌아감 최대페널티 = -10

영업당 의사결정   = 최대 2개
피로회복/수면시간 = -16/시간

가격 최소         = 5,000원
가격 최대         = 100,000원
가격 단위         = 1,000원
```
