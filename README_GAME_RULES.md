# Chickenmaster2 - 게임 규칙

## 게임 목표

한국에서 치킨집을 경영하는 테마의 경영시뮬레이션 게임입니다.
TRPG적인 DICE 요소를 추가하여 단순히 치킨을 만들어 파는 타이쿤 게임보다는
확률적인 선택지를 통해 불확실성을 선택하고 매 플레이마다 다른 경험과
무작위적 요소를 통한 재미를 느끼게 하는것이 목표입니다.
동시에 타이쿤류 게임의 근본적인 재미 요소인 운영의 재미도 느낄 수 있어야 합니다.

---

## 기본 규칙

### 캐릭터 선택
- 캐릭터는 3가지 중 선택합니다.
- 각 캐릭터는 배경 설정에 따라 다른 능력치를 갖게 됩니다.
- 각 능력치는 무작위적 요소를 보정해 좀 더 원하는 결과를 얻을 확률을 높입니다.

### 주사위 시스템
- **D100 다이스** 사용 (1~100)
- `src/engine/dice_system.py`의 `calldice` 함수 사용
- 별도의 모듈 생성 금지
- 주사위 굴림은 `calldice`로 상수 값을 받아 성공/실패를 판정

---

## AI 경쟁자 시스템

플레이어의 Exploit을 방지하고 게임 밸런스를 유지합니다.

### 기본 규칙
- **2명 이상**의 경쟁자 존재
- 각각 **다른 전략** 보유 (공격적/방어적)
- 설정된 성향에 따라 행동

### 지연 행동 시스템
- 플레이어 선택에 **3~10턴 랜덤 지연** 후 반응
- 플레이어 이익 감소 & 자신의 이익 증대를 목표로 행동
- 필요시 플레이어에게 이득을 주면서도 본인 이익 극대화 가능

### 파산 시스템
- 자금 0원 상태로 **30일 지속 시 패배**
- 패배 시 **30~120일** 후 새로운 경쟁자 투입
- 신규 경쟁자는 **이전과 다른 전략** 선택
- 각 경쟁자는 독립적으로 이익 극대화 추구

---

## AI 고객 시스템

### 고객 구성
- **10%**: 개별 AI 고객 (각자 행동 판정)
- **90%**: 수치 고객 (점유율에 따라 분배)

### 구매 판정 요소
개별 AI 고객은 다음 4가지 요소로 구매 결정:
1. **가격** - 시장 평균 대비 상대 가격
2. **품질** - 요리 스탯 + 연구도 + 재료 품질
3. **인지도** - 판매 누적 + 광고 효과
4. **욕구** - 0~100 수치, 구매 후 0으로 초기화

### 욕구 시스템
- 구매 후 0으로 초기화
- 매일 `[Calldice / 10]`만큼 증가 (개별 고객마다 독립적)
- 매턴 `[욕구]%` 확률로 구매 여부 판정
- 구매 결정 시 `[점유율]` 확률로 매장 선택

### 점유율 계산
```
종합점수 = 가격점수 + 품질점수 + 인지도점수
점유율 = 해당 매장 종합점수 / 전체 매장 종합점수 합계 × 100
```

### 구매 예시
```
상권 인구 1,000명 = 100명(AI) + 900명(수치)
A 매장 점유율 10%
→ 개별 AI: 100명 중 각자 판정
→ 수치: 900 × 10% = 90명 모수로 판정 (Calldice / 90 / 7)
```

---

## 점수 시스템

### 가격 점수
```python
시장평균가격 = sum(전체 동일분류 제품 가격) / 제품 수
개별제품 가격점수 = (개별 제품 가격 / 시장평균가격) × 100
매장 가격점수 = sum(매장 내 제품 가격점수) / 매장 제품 수
```

### 품질 점수
```python
시장평균품질 = sum(전체 동일분류 제품 품질) / 제품 수
개별제품 품질점수 = (개별 제품 품질 / 시장평균품질) × 100
매장 품질점수 = sum(매장 내 제품 품질점수) / 매장 제품 수

제품 품질 = avg([요리 스탯, 연구도, 재료 품질])
```

### 인지도 점수
```python
시장평균인지도 = sum(전체 동일분류 제품 인지도) / 제품 수
개별제품 인지도점수 = (개별 제품 인지도 / 시장평균인지도) × 100
매장 인지도점수 = sum(매장 내 제품 인지도점수) / 매장 제품 수
```

#### 인지도 변화
- 판매당 **+3** 증가
- 매일 **-1** 감소
- 광고 투자 > 경쟁자: 광고액 차이만큼 증가/일
- 광고 투자 ≤ 경쟁자: **+1**/일
- `[점유율] × 10` 만큼 매일 증가

---

## 제품 시스템

### 기본 제품
- 시작 시 **"후라이드 치킨"** 보유

### 레시피 획득
- **이벤트** 또는 **연구**를 통해 랜덤 획득
- 경쟁자가 신제품 출시 시 이벤트 발생
- `[레시피 카피]` 행동 가능: `[CallDice, Cook]` 판정
  - 성공: 7턴 후 연구도 0 레시피 획득
  - 실패: 7턴 후 재시도 이벤트 발생

### 신제품 출시
- 레시피 → 제품 전환 (레시피 삭제)
- 이미 보유한 레시피는 이벤트 미발생

### 판매 중지
- 제품 → 레시피 환원
- 인지도 **0**으로 초기화

### 가격 조정
- 매턴 시작 시 행동으로 조정 가능
- **1,000원 단위** 조정
- 범위: **0원 ~ 1,000,000원**

---

## 플레이어 스탯

### 5가지 기본 스탯
| 스탯 | 코드명 | 설명 |
|------|--------|------|
| 요리 | `cook` | 요리 품질 영향 |
| 경영 | `management` | 경영 효율 |
| 서비스 | `service` | 고객 만족도 |
| 기술 | `tech` | 장비 활용/연구 |
| 체력 | `stamina` | 피로도 한계 |

### 경험치 시스템
- Calldice 성공 시 **+10 EXP**
- 100 EXP 달성 시 스탯 **+1**, EXP 0 초기화
- 연구/이벤트로도 증가 가능

---

## 변동 상태

### 피로도 시스템
| 피로도 | 상태 | 효과 |
|--------|------|------|
| ≥ 50% 체력 | ⚠️ 경고 | 경고 메시지 |
| ≥ 90% 체력 | 🔴 위험 | 위험 경고 |
| ≥ 100% 체력 | 💀 쇠약 | 모든 스탯 **1/2** |
| ≥ 200% 체력 | ❌ 기절 | **행동 불가** |

### 행복도 시스템
**범위**: 0~100, 기준값: 50

#### 변화 요인
- ⬇️ 감소: 피로도 ≥50% 턴 종료, 적자 발생
- ⬆️ 증가: 피로도 <50% 턴 종료, 흑자 발생
- 이벤트를 통한 증감

#### 계산 공식
```python
f(x) = 50 ± A × √(|x - 50| / k)
# A = 50, k = 1
```
> 50에서 멀어질수록 증가량 기울기 감소

### 자금
- 플레이어와 경쟁자 AI 공통 보유
- 매출/비용으로 증감

---

## 매장 시스템

### 기본 규칙
- 참여자당 **1개 이상** 보유
- 초기: **1개** 매장만 시작
- 제품 배치 & 알바 고용 가능

### 재고 관리
- **Queue 구조**: 선입선출 (FIFO)
- 판매 1회당 재고 **-1**
- `[재료구입]` 행동으로 시장가격에 구매
- **30일 이상 미소모** 시 `[위험한 재고]` 이벤트
  - ⚠️ 경쟁자 AI는 이벤트 미발생

### 고정 비용
- 임대료
- 관리비

---

## 알바 시스템

### 기능
- 피로도 상승 **20~50% 감소** (랜덤)
- 알바만으로 매장 운영 불가

### 특성
- 고유 랜덤 한국인 이름
- 월급 지급 필요
- 해고 가능

---

## 점장 시스템

### 역할
- 2번째 이상 매장 운영
- **경쟁자 AI와 동일** 행동 패턴

### 채용
- 매장 2개 이상 시 **이벤트로 고용**
- 미고용 시 해당 매장 **운영 불가**
- 랜덤 스탯 보유

> ⚠️ 경쟁자 AI는 점장 시스템 없음

---

## 연구 시스템

### 기본 규칙
- 자금 & 시간 소요
- 스탯에 따른 보정

### 진행도 계산
```python
일일 진행도 = {1 + [calldice/10]} × {관련 스탯} × (난이도 보정치)
```
- 진행도: **0~100**
- 난이도: 정수값 (높을수록 느림)

---

## 턴 시스템

### 기본 구조
- **1턴 = 1일**
- 시간 자원: **12시간** (09:00~21:00)
- 게임 1루프 = 1턴 소모

### 이벤트 제한
- 턴당 **최대 1개** 이벤트
- 2개 이상 발생 시: 난수 이벤트는 다음 턴 확정 발생

---

## 행동 시스템

### 6가지 행동 카테고리

| 카테고리 | 세부 행동 |
|----------|-----------|
| **조리** | 재료준비, 조리, 재료점검 |
| **광고** | 전단지, 온라인광고, 배달앱 |
| **운영** | 재료주문, 청소, 장비점검, 알바고용 |
| **연구** | 레시피, 경영, 광고, 서비스 |
| **개인** | 휴가, 학습, 운동 |
| **휴식** | 수면 (피로도 회복) |

### 기본 규칙
- 모든 행동은 **시간 소모** 필수
- 휴가/휴식 제외 → **피로도 증가**

### 휴식 시스템
- 수면으로 간주
- 시간당 피로도 **-16**
- 피로도는 0 이하로 떨어지지 않음

---

## 이벤트 시스템

### 5가지 이벤트 분류

#### 1. 일상 이벤트
- 특별 조건 없음
- 다른 이벤트 없을 시 랜덤 발생
- 쿨다운 경과 후 재발생 가능

#### 2. 기회 이벤트
- 특정 조건 달성 시 발생
- 예: 특정 선택지 선택, 스탯 일정 이상

#### 3. 선택 이벤트
- 트레이드오프 선택지 제공
- 예: 튀김기 고장
  - Y → 자금 -100만원, 1년간 고장 없음
  - N → 피로도 +10, Tech 경험치 +50

#### 4. 연쇄 이벤트
- 다른 이벤트로부터 파생
- 쿨다운 후 **확정 발생**
- 예: 튀김기 수리 → 신제품 테스트 → 보상 제안 → 판매 제안

#### 5. 위기 이벤트
- 일정 턴 경과 후 발생
- 난이도 조절 역할
- 극복 시 **특별 보상** 필수
- **절대 재발생 없음**

### 발생 알고리즘

```python
1. 발생 예정 이벤트 체크
2. FALSE → 일상 제외 발생 가능 이벤트 추출
3. Null → 일상 이벤트 발생 판정 (Calldice > 20)
4. True → 일상 이벤트 랜덤 선택
5. 쿨다운 ≥1 → 4로 Callback
6. 쿨다운 =0 → 이벤트 발생, 게임 루프 진행
7. FALSE → 이벤트 미발생, 게임 루프 진행
```

---

## 구현 참고사항

- 헥사고날 아키텍처 적용
- 도메인 모델: `src/core/domain/`
- 게임 엔진: `src/engine/`
- 상수 정의: `src/constants.py`
- 이벤트 데이터: `data/events.csv`

자세한 개발 가이드는 `TODO.md` 참조.
